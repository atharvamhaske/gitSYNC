/*! For license information please see background.js.LICENSE.txt */
(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function n(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach(function(e){r(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function r(e,n,r){return(n=function(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,o,i){var a=r&&r.prototype instanceof s?r:s,f=Object.create(a.prototype);return c(f,"_invoke",function(n,r,o){var c,i,a,s=0,f=o||[],p=!1,l={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(e,n){return c=e,i=0,a=t,l.n=n,u}};function h(n,r){for(i=n,a=r,e=0;!p&&s&&!o&&e<f.length;e++){var o,c=f[e],h=l.p,y=c[2];n>3?(o=y===r)&&(a=c[(i=c[4])?5:(i=3,3)],c[4]=c[5]=t):c[0]<=h&&((o=n<2&&h<c[1])?(i=0,l.v=r,l.n=c[1]):h<y&&(o=n<3||c[0]>r||r>y)&&(c[4]=n,c[5]=r,l.n=y,i=0))}if(o||n>1)return u;throw p=!0,r}return function(o,f,y){if(s>1)throw TypeError("Generator is already running");for(p&&1===f&&h(f,y),i=f,a=y;(e=i<2?t:a)||!p;){c||(i?i<3?(i>1&&(l.n=-1),h(i,a)):l.n=a:l.v=a);try{if(s=2,c){if(i||(o="next"),e=c[o]){if(!(e=e.call(c,a)))throw TypeError("iterator result is not an object");if(!e.done)return e;a=e.value,i<2&&(i=0)}else 1===i&&(e=c.return)&&e.call(c),i<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),i=1);c=t}else if((e=(p=l.n<0)?a:n.call(r,l))!==u)break}catch(e){c=t,i=1,a=e}finally{s=1}}return{value:e,done:p}}}(n,o,i),!0),f}var u={};function s(){}function f(){}function p(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(c(e={},r,function(){return this}),e),h=p.prototype=s.prototype=Object.create(l);function y(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,i,"GeneratorFunction")),t.prototype=Object.create(h),t}return f.prototype=p,c(h,"constructor",p),c(p,"constructor",f),f.displayName="GeneratorFunction",c(p,i,"GeneratorFunction"),c(h),c(h,i,"Generator"),c(h,r,function(){return this}),c(h,"toString",function(){return"[object Generator]"}),(o=function(){return{w:a,m:y}})()}function c(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}c=function(t,e,n,r){function i(e,n){c(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},c(t,e,n,r)}function i(t,e,n,r,o,c,i){try{var a=t[c](i),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,o)}function a(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var c=t.apply(e,n);function a(t){i(c,r,o,a,u,"next",t)}function u(t){i(c,r,o,a,u,"throw",t)}a(void 0)})}}var u="https://api.github.com";function s(){return(s=a(o().m(function t(e){var n,r;return o().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,fetch("https://github.com/login/oauth/access_token",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({client_id:"YOUR_GITHUB_CLIENT_ID",client_secret:"YOUR_GITHUB_CLIENT_SECRET",code:e})});case 1:if((n=t.v).ok){t.n=2;break}throw new Error("Failed to exchange code for token");case 2:return t.n=3,n.json();case 3:if(!(r=t.v).error){t.n=4;break}throw new Error(r.error_description||r.error);case 4:return t.a(2,r.access_token)}},t)}))).apply(this,arguments)}function f(){return(f=a(o().m(function t(e){var n,r,c,i,a,u,s,f,l,h,d,v,m,w;return o().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,chrome.storage.local.get(["githubToken","repoUrl"]);case 1:if((n=t.v).githubToken&&n.repoUrl){t.n=2;break}throw new Error("Not authenticated. Please complete onboarding.");case 2:return r=y(n.repoUrl),c=r.owner,i=r.repo,a=e.name,u=e.difficulty,s=e.language,f=e.code,l=e.extension,h=b(a)+"."+l,d=u.toLowerCase(),v="".concat(d,"/").concat(h),m="Add ".concat(a," (").concat(u,") - ").concat(s),t.n=3,p(n.githubToken,c,i,v,f,m);case 3:return w=t.v,t.n=4,g(e);case 4:return chrome.notifications.create({type:"basic",iconUrl:"icons/icon48.png",title:"GitSync",message:"Synced: ".concat(a," to ").concat(d,"/")}),t.a(2,w)}},t)}))).apply(this,arguments)}function p(t,e,n,r,o,c){return l.apply(this,arguments)}function l(){return(l=a(o().m(function t(e,r,c,i,a,s){var f,p,l,h,y,b;return o().w(function(t){for(;;)switch(t.n){case 0:return f=null,t.n=1,fetch("".concat(u,"/repos/").concat(r,"/").concat(c,"/contents/").concat(i),{headers:{Authorization:"token ".concat(e),Accept:"application/vnd.github.v3+json"}});case 1:if(!(p=t.v).ok){t.n=3;break}return t.n=2,p.json();case 2:l=t.v,f=l.sha;case 3:return h=n({message:s,content:btoa(unescape(encodeURIComponent(a)))},f&&{sha:f}),t.n=4,fetch("".concat(u,"/repos/").concat(r,"/").concat(c,"/contents/").concat(i),{method:"PUT",headers:{Authorization:"token ".concat(e),Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify(h)});case 4:if((y=t.v).ok){t.n=6;break}return t.n=5,y.json();case 5:throw b=t.v,new Error(b.message||"Failed to push to GitHub");case 6:return t.a(2,y.json())}},t)}))).apply(this,arguments)}function h(){return(h=a(o().m(function t(e){var n,r;return o().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,fetch("https://leetcode.com/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n    query questionData($titleSlug: String!) {\n      question(titleSlug: $titleSlug) {\n        questionId\n        title\n        difficulty\n        content\n      }\n    }\n  ",variables:{titleSlug:e}})});case 1:if((n=t.v).ok){t.n=2;break}throw new Error("Failed to fetch problem info");case 2:return t.n=3,n.json();case 3:return r=t.v,t.a(2,r.data.question)}},t)}))).apply(this,arguments)}function y(t){var e=t.match(/github\.com\/([^\/]+)\/([^\/]+)/);if(!e)throw new Error("Invalid GitHub repository URL");return{owner:e[1],repo:e[2].replace(/\.git$/,"")}}function b(t){return t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,function(t,e){return e.toUpperCase()}).replace(/^./,function(t){return t.toLowerCase()}).replace(/[^a-zA-Z0-9]/g,"")}function g(t){return d.apply(this,arguments)}function d(){return(d=a(o().m(function t(e){var r,c,i;return o().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,chrome.storage.local.get(["syncedProblems"]);case 1:return r=t.v,c=r.syncedProblems||[],(i=c.findIndex(function(t){return t.name===e.name&&t.language===e.language}))>=0?c[i]=n(n({},e),{},{syncedAt:Date.now()}):c.unshift(n(n({},e),{},{syncedAt:Date.now()})),t.n=2,chrome.storage.local.set({syncedProblems:c.slice(0,100)});case 2:return t.a(2)}},t)}))).apply(this,arguments)}chrome.runtime.onMessage.addListener(function(t,e,n){return"EXCHANGE_CODE"===t.type?(function(t){return s.apply(this,arguments)}(t.code).then(function(t){return n({token:t})}).catch(function(t){return n({error:t.message})}),!0):"SYNC_SOLUTION"===t.type?(function(t){return f.apply(this,arguments)}(t.problem).then(function(t){return n({success:!0,result:t})}).catch(function(t){return n({success:!1,error:t.message})}),!0):"GET_PROBLEM_INFO"===t.type?(function(t){return h.apply(this,arguments)}(t.slug).then(function(t){return n({success:!0,info:t})}).catch(function(t){return n({success:!1,error:t.message})}),!0):void 0}),console.log("GitSync background service worker started")})();