/*! For license information please see background.js.LICENSE.txt */
(()=>{function t(n){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(n)}function n(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),e.push.apply(e,r)}return e}function e(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?n(Object(o),!0).forEach(function(n){r(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}function r(n,e,r){return(e=function(n){var e=function(n){if("object"!=t(n)||!n)return n;var e=n[Symbol.toPrimitive];if(void 0!==e){var r=e.call(n,"string");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==t(e)?e:e+""}(e))in n?Object.defineProperty(n,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[e]=r,n}function o(){var t,n,e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",i=e.toStringTag||"@@toStringTag";function a(e,r,o,i){var a=r&&r.prototype instanceof s?r:s,l=Object.create(a.prototype);return c(l,"_invoke",function(e,r,o){var c,i,a,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(n,e){return c=n,i=0,a=t,p.n=e,u}};function y(e,r){for(i=e,a=r,n=0;!f&&s&&!o&&n<l.length;n++){var o,c=l[n],y=p.p,h=c[2];e>3?(o=h===r)&&(a=c[(i=c[4])?5:(i=3,3)],c[4]=c[5]=t):c[0]<=y&&((o=e<2&&y<c[1])?(i=0,p.v=r,p.n=c[1]):y<h&&(o=e<3||c[0]>r||r>h)&&(c[4]=e,c[5]=r,p.n=h,i=0))}if(o||e>1)return u;throw f=!0,r}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,h),i=l,a=h;(n=i<2?t:a)||!f;){c||(i?i<3?(i>1&&(p.n=-1),y(i,a)):p.n=a:p.v=a);try{if(s=2,c){if(i||(o="next"),n=c[o]){if(!(n=n.call(c,a)))throw TypeError("iterator result is not an object");if(!n.done)return n;a=n.value,i<2&&(i=0)}else 1===i&&(n=c.return)&&n.call(c),i<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),i=1);c=t}else if((n=(f=p.n<0)?a:e.call(r,p))!==u)break}catch(n){c=t,i=1,a=n}finally{s=1}}return{value:n,done:f}}}(e,o,i),!0),l}var u={};function s(){}function l(){}function f(){}n=Object.getPrototypeOf;var p=[][r]?n(n([][r]())):(c(n={},r,function(){return this}),n),y=f.prototype=s.prototype=Object.create(p);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,c(t,i,"GeneratorFunction")),t.prototype=Object.create(y),t}return l.prototype=f,c(y,"constructor",f),c(f,"constructor",l),l.displayName="GeneratorFunction",c(f,i,"GeneratorFunction"),c(y),c(y,i,"Generator"),c(y,r,function(){return this}),c(y,"toString",function(){return"[object Generator]"}),(o=function(){return{w:a,m:h}})()}function c(t,n,e,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}c=function(t,n,e,r){function i(n,e){c(t,n,function(t){return this._invoke(n,e,t)})}n?o?o(t,n,{value:e,enumerable:!r,configurable:!r,writable:!r}):t[n]=e:(i("next",0),i("throw",1),i("return",2))},c(t,n,e,r)}function i(t,n,e,r,o,c,i){try{var a=t[c](i),u=a.value}catch(t){return void e(t)}a.done?n(u):Promise.resolve(u).then(r,o)}function a(t){return function(){var n=this,e=arguments;return new Promise(function(r,o){var c=t.apply(n,e);function a(t){i(c,r,o,a,u,"next",t)}function u(t){i(c,r,o,a,u,"throw",t)}a(void 0)})}}var u="https://api.github.com";function s(){return(s=a(o().m(function t(n){var e,r,c,i,a,u,s,f,p,g,d,v,m,w;return o().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,chrome.storage.local.get(["githubToken","repoUrl"]);case 1:if((e=t.v).githubToken&&e.repoUrl){t.n=2;break}throw new Error("Not authenticated. Please complete onboarding.");case 2:return r=y(e.repoUrl),c=r.owner,i=r.repo,a=n.name,u=n.difficulty,s=n.language,f=n.code,p=n.extension,g=h(a)+"."+p,d=u.toLowerCase(),v="".concat(d,"/").concat(g),m="Add ".concat(a," (").concat(u,") - ").concat(s),t.n=3,l(e.githubToken,c,i,v,f,m);case 3:return w=t.v,t.n=4,b(n);case 4:return chrome.notifications.create({type:"basic",iconUrl:"icons/icon48.png",title:"GitSync",message:"Synced: ".concat(a," to ").concat(d,"/")}),t.a(2,w)}},t)}))).apply(this,arguments)}function l(t,n,e,r,o,c){return f.apply(this,arguments)}function f(){return(f=a(o().m(function t(n,r,c,i,a,s){var l,f,p,y,h,b,g,d,v,m,w,S,j,O,k;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:return l=null,t.p=1,t.n=2,fetch("".concat(u,"/repos/").concat(r,"/").concat(c,"/contents/").concat(i),{headers:{Authorization:"token ".concat(n),Accept:"application/vnd.github.v3+json"}});case 2:if(!(f=t.v).ok){t.n=4;break}return t.n=3,f.json();case 3:"file"===(p=t.v).type&&p.sha&&(l=p.sha,console.log("GitSync: Found existing file, using SHA:",l.substring(0,8)+"..."));case 4:t.n=6;break;case 5:t.p=5,O=t.v,console.log("GitSync: Error checking for existing file:",O);case 6:return y=e({message:s,content:btoa(unescape(encodeURIComponent(a)))},l&&{sha:l}),t.n=7,fetch("".concat(u,"/repos/").concat(r,"/").concat(c,"/contents/").concat(i),{method:"PUT",headers:{Authorization:"token ".concat(n),Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify(y)});case 7:if((h=t.v).ok){t.n=18;break}return t.n=8,h.json();case 8:if(b=t.v,!(g=b.message||"Failed to push to GitHub").includes("does not match")){t.n=17;break}return console.log("GitSync: SHA mismatch detected, fetching latest SHA and retrying"),t.p=9,t.n=10,fetch("".concat(u,"/repos/").concat(r,"/").concat(c,"/contents/").concat(i),{headers:{Authorization:"token ".concat(n),Accept:"application/vnd.github.v3+json"}});case 10:if(d=t.v,v=null,!d.ok){t.n=12;break}return t.n=11,d.json();case 11:"file"===(m=t.v).type&&m.sha&&(v=m.sha);case 12:return w=e({message:s+" (updated)",content:btoa(unescape(encodeURIComponent(a)))},v&&{sha:v}),t.n=13,fetch("".concat(u,"/repos/").concat(r,"/").concat(c,"/contents/").concat(i),{method:"PUT",headers:{Authorization:"token ".concat(n),Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify(w)});case 13:if((S=t.v).ok){t.n=15;break}return t.n=14,S.json();case 14:throw j=t.v,new Error(j.message||g);case 15:return console.log("GitSync: Successfully updated file after SHA retry"),t.a(2,S.json());case 16:throw t.p=16,k=t.v,new Error(k.message||g);case 17:throw new Error(g);case 18:return t.a(2,h.json())}},t,null,[[9,16],[1,5]])}))).apply(this,arguments)}function p(){return(p=a(o().m(function t(n){var e,r;return o().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,fetch("https://leetcode.com/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n    query questionData($titleSlug: String!) {\n      question(titleSlug: $titleSlug) {\n        questionId\n        title\n        difficulty\n        content\n      }\n    }\n  ",variables:{titleSlug:n}})});case 1:if((e=t.v).ok){t.n=2;break}throw new Error("Failed to fetch problem info");case 2:return t.n=3,e.json();case 3:return r=t.v,t.a(2,r.data.question)}},t)}))).apply(this,arguments)}function y(t){var n=t.match(/github\.com\/([^\/]+)\/([^\/]+)/);if(!n)throw new Error("Invalid GitHub repository URL");return{owner:n[1],repo:n[2].replace(/\.git$/,"")}}function h(t){if(!t||"string"!=typeof t)return console.error("GitSync: Invalid string for toCamelCase:",t),"solution";if(t=t.trim(),/^\d+$/.test(t))return console.warn("GitSync: Problem name is just a number, using default"),"solution";var n=t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,function(t,n){return n.toUpperCase()}).replace(/^./,function(t){return t.toLowerCase()}).replace(/[^a-zA-Z0-9]/g,"");return n&&0!==n.length?n:(console.warn("GitSync: camelCase conversion resulted in empty string"),"solution")}function b(t){return g.apply(this,arguments)}function g(){return(g=a(o().m(function t(n){var r,c,i;return o().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,chrome.storage.local.get(["syncedProblems"]);case 1:return r=t.v,c=r.syncedProblems||[],(i=c.findIndex(function(t){return t.name===n.name&&t.language===n.language}))>=0?c[i]=e(e({},n),{},{syncedAt:Date.now()}):c.unshift(e(e({},n),{},{syncedAt:Date.now()})),t.n=2,chrome.storage.local.set({syncedProblems:c.slice(0,100)});case 2:return t.a(2)}},t)}))).apply(this,arguments)}chrome.runtime.onMessage.addListener(function(t,n,e){return"SYNC_SOLUTION"===t.type?(function(t){return s.apply(this,arguments)}(t.problem).then(function(t){return e({success:!0,result:t})}).catch(function(t){return e({success:!1,error:t.message})}),!0):"GET_PROBLEM_INFO"===t.type?(function(t){return p.apply(this,arguments)}(t.slug).then(function(t){return e({success:!0,info:t})}).catch(function(t){return e({success:!1,error:t.message})}),!0):void 0}),console.log("GitSync background service worker started")})();