/*! For license information please see background.js.LICENSE.txt */
(()=>{function t(n){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(n)}function n(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),e.push.apply(e,r)}return e}function e(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?n(Object(o),!0).forEach(function(n){r(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}function r(n,e,r){return(e=function(n){var e=function(n){if("object"!=t(n)||!n)return n;var e=n[Symbol.toPrimitive];if(void 0!==e){var r=e.call(n,"string");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==t(e)?e:e+""}(e))in n?Object.defineProperty(n,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[e]=r,n}function o(){var t,n,e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",i=e.toStringTag||"@@toStringTag";function a(e,r,o,i){var a=r&&r.prototype instanceof s?r:s,f=Object.create(a.prototype);return c(f,"_invoke",function(e,r,o){var c,i,a,s=0,f=o||[],l=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(n,e){return c=n,i=0,a=t,p.n=e,u}};function y(e,r){for(i=e,a=r,n=0;!l&&s&&!o&&n<f.length;n++){var o,c=f[n],y=p.p,h=c[2];e>3?(o=h===r)&&(a=c[(i=c[4])?5:(i=3,3)],c[4]=c[5]=t):c[0]<=y&&((o=e<2&&y<c[1])?(i=0,p.v=r,p.n=c[1]):y<h&&(o=e<3||c[0]>r||r>h)&&(c[4]=e,c[5]=r,p.n=h,i=0))}if(o||e>1)return u;throw l=!0,r}return function(o,f,h){if(s>1)throw TypeError("Generator is already running");for(l&&1===f&&y(f,h),i=f,a=h;(n=i<2?t:a)||!l;){c||(i?i<3?(i>1&&(p.n=-1),y(i,a)):p.n=a:p.v=a);try{if(s=2,c){if(i||(o="next"),n=c[o]){if(!(n=n.call(c,a)))throw TypeError("iterator result is not an object");if(!n.done)return n;a=n.value,i<2&&(i=0)}else 1===i&&(n=c.return)&&n.call(c),i<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),i=1);c=t}else if((n=(l=p.n<0)?a:e.call(r,p))!==u)break}catch(n){c=t,i=1,a=n}finally{s=1}}return{value:n,done:l}}}(e,o,i),!0),f}var u={};function s(){}function f(){}function l(){}n=Object.getPrototypeOf;var p=[][r]?n(n([][r]())):(c(n={},r,function(){return this}),n),y=l.prototype=s.prototype=Object.create(p);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,c(t,i,"GeneratorFunction")),t.prototype=Object.create(y),t}return f.prototype=l,c(y,"constructor",l),c(l,"constructor",f),f.displayName="GeneratorFunction",c(l,i,"GeneratorFunction"),c(y),c(y,i,"Generator"),c(y,r,function(){return this}),c(y,"toString",function(){return"[object Generator]"}),(o=function(){return{w:a,m:h}})()}function c(t,n,e,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}c=function(t,n,e,r){function i(n,e){c(t,n,function(t){return this._invoke(n,e,t)})}n?o?o(t,n,{value:e,enumerable:!r,configurable:!r,writable:!r}):t[n]=e:(i("next",0),i("throw",1),i("return",2))},c(t,n,e,r)}function i(t,n,e,r,o,c,i){try{var a=t[c](i),u=a.value}catch(t){return void e(t)}a.done?n(u):Promise.resolve(u).then(r,o)}function a(t){return function(){var n=this,e=arguments;return new Promise(function(r,o){var c=t.apply(n,e);function a(t){i(c,r,o,a,u,"next",t)}function u(t){i(c,r,o,a,u,"throw",t)}a(void 0)})}}var u="https://api.github.com";function s(){return(s=a(o().m(function t(n){var e,r,c,i,a,u,s,l,p,g,v,m,d,w;return o().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,chrome.storage.local.get(["githubToken","repoUrl"]);case 1:if((e=t.v).githubToken&&e.repoUrl){t.n=2;break}throw new Error("Not authenticated. Please complete onboarding.");case 2:return r=y(e.repoUrl),c=r.owner,i=r.repo,a=n.name,u=n.difficulty,s=n.language,l=n.code,p=n.extension,g=h(a)+"."+p,v=u.toLowerCase(),m="".concat(v,"/").concat(g),d="Add ".concat(a," (").concat(u,") - ").concat(s),t.n=3,f(e.githubToken,c,i,m,l,d);case 3:return w=t.v,t.n=4,b(n);case 4:return chrome.notifications.create({type:"basic",iconUrl:"icons/icon48.png",title:"GitSync",message:"Synced: ".concat(a," to ").concat(v,"/")}),t.a(2,w)}},t)}))).apply(this,arguments)}function f(t,n,e,r,o,c){return l.apply(this,arguments)}function l(){return(l=a(o().m(function t(n,r,c,i,a,s){var f,l,p,y,h,b;return o().w(function(t){for(;;)switch(t.n){case 0:return f=null,t.n=1,fetch("".concat(u,"/repos/").concat(r,"/").concat(c,"/contents/").concat(i),{headers:{Authorization:"token ".concat(n),Accept:"application/vnd.github.v3+json"}});case 1:if(!(l=t.v).ok){t.n=3;break}return t.n=2,l.json();case 2:p=t.v,f=p.sha;case 3:return y=e({message:s,content:btoa(unescape(encodeURIComponent(a)))},f&&{sha:f}),t.n=4,fetch("".concat(u,"/repos/").concat(r,"/").concat(c,"/contents/").concat(i),{method:"PUT",headers:{Authorization:"token ".concat(n),Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify(y)});case 4:if((h=t.v).ok){t.n=6;break}return t.n=5,h.json();case 5:throw b=t.v,new Error(b.message||"Failed to push to GitHub");case 6:return t.a(2,h.json())}},t)}))).apply(this,arguments)}function p(){return(p=a(o().m(function t(n){var e,r;return o().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,fetch("https://leetcode.com/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n    query questionData($titleSlug: String!) {\n      question(titleSlug: $titleSlug) {\n        questionId\n        title\n        difficulty\n        content\n      }\n    }\n  ",variables:{titleSlug:n}})});case 1:if((e=t.v).ok){t.n=2;break}throw new Error("Failed to fetch problem info");case 2:return t.n=3,e.json();case 3:return r=t.v,t.a(2,r.data.question)}},t)}))).apply(this,arguments)}function y(t){var n=t.match(/github\.com\/([^\/]+)\/([^\/]+)/);if(!n)throw new Error("Invalid GitHub repository URL");return{owner:n[1],repo:n[2].replace(/\.git$/,"")}}function h(t){return t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,function(t,n){return n.toUpperCase()}).replace(/^./,function(t){return t.toLowerCase()}).replace(/[^a-zA-Z0-9]/g,"")}function b(t){return g.apply(this,arguments)}function g(){return(g=a(o().m(function t(n){var r,c,i;return o().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,chrome.storage.local.get(["syncedProblems"]);case 1:return r=t.v,c=r.syncedProblems||[],(i=c.findIndex(function(t){return t.name===n.name&&t.language===n.language}))>=0?c[i]=e(e({},n),{},{syncedAt:Date.now()}):c.unshift(e(e({},n),{},{syncedAt:Date.now()})),t.n=2,chrome.storage.local.set({syncedProblems:c.slice(0,100)});case 2:return t.a(2)}},t)}))).apply(this,arguments)}chrome.runtime.onMessage.addListener(function(t,n,e){return"SYNC_SOLUTION"===t.type?(function(t){return s.apply(this,arguments)}(t.problem).then(function(t){return e({success:!0,result:t})}).catch(function(t){return e({success:!1,error:t.message})}),!0):"GET_PROBLEM_INFO"===t.type?(function(t){return p.apply(this,arguments)}(t.slug).then(function(t){return e({success:!0,info:t})}).catch(function(t){return e({success:!1,error:t.message})}),!0):void 0}),console.log("GitSync background service worker started")})();