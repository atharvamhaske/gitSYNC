/*! For license information please see background.js.LICENSE.txt */
(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function n(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach(function(e){r(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function r(e,n,r){return(n=function(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function i(n,r,o,a){var i=r&&r.prototype instanceof s?r:s,l=Object.create(i.prototype);return c(l,"_invoke",function(n,r,o){var c,a,i,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,n){return c=e,a=0,i=t,p.n=n,u}};function y(n,r){for(a=n,i=r,e=0;!f&&s&&!o&&e<l.length;e++){var o,c=l[e],y=p.p,h=c[2];n>3?(o=h===r)&&(i=c[(a=c[4])?5:(a=3,3)],c[4]=c[5]=t):c[0]<=y&&((o=n<2&&y<c[1])?(a=0,p.v=r,p.n=c[1]):y<h&&(o=n<3||c[0]>r||r>h)&&(c[4]=n,c[5]=r,p.n=h,a=0))}if(o||n>1)return u;throw f=!0,r}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,h),a=l,i=h;(e=a<2?t:i)||!f;){c||(a?a<3?(a>1&&(p.n=-1),y(a,i)):p.n=i:p.v=i);try{if(s=2,c){if(a||(o="next"),e=c[o]){if(!(e=e.call(c,i)))throw TypeError("iterator result is not an object");if(!e.done)return e;i=e.value,a<2&&(a=0)}else 1===a&&(e=c.return)&&e.call(c),a<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),a=1);c=t}else if((e=(f=p.n<0)?i:n.call(r,p))!==u)break}catch(e){c=t,a=1,i=e}finally{s=1}}return{value:e,done:f}}}(n,o,a),!0),l}var u={};function s(){}function l(){}function f(){}e=Object.getPrototypeOf;var p=[][r]?e(e([][r]())):(c(e={},r,function(){return this}),e),y=f.prototype=s.prototype=Object.create(p);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,c(t,a,"GeneratorFunction")),t.prototype=Object.create(y),t}return l.prototype=f,c(y,"constructor",f),c(f,"constructor",l),l.displayName="GeneratorFunction",c(f,a,"GeneratorFunction"),c(y),c(y,a,"Generator"),c(y,r,function(){return this}),c(y,"toString",function(){return"[object Generator]"}),(o=function(){return{w:i,m:h}})()}function c(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}c=function(t,e,n,r){function a(e,n){c(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},c(t,e,n,r)}function a(t,e,n,r,o,c,a){try{var i=t[c](a),u=i.value}catch(t){return void n(t)}i.done?e(u):Promise.resolve(u).then(r,o)}function i(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var c=t.apply(e,n);function i(t){a(c,r,o,i,u,"next",t)}function u(t){a(c,r,o,i,u,"throw",t)}i(void 0)})}}var u="https://api.github.com";chrome.runtime.onMessage.addListener(function(t,e,n){return"SYNC_SOLUTION"===t.type?(function(t){return l.apply(this,arguments)}(t.problem).then(function(t){return n({success:!0,result:t})}).catch(function(t){return n({success:!1,error:t.message})}),!0):"GET_PROBLEM_INFO"===t.type?(function(t){return y.apply(this,arguments)}(t.slug).then(function(t){return n({success:!0,info:t})}).catch(function(t){return n({success:!1,error:t.message})}),!0):void 0});var s=new Set;function l(){return(l=i(o().m(function t(e){var n,r,c,a,i,u,l,p,y,d,m,v,w,S,j,O;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:if(n=e.code?Array.from(e.code).reduce(function(t,e){return(t<<5)-t+e.charCodeAt(0)},0):0,r="".concat(e.name,"-").concat(e.language,"-").concat(Math.abs(n)),!s.has(r)){t.n=1;break}throw console.log("GitSync: Sync already in progress for:",r),new Error("Sync already in progress for this solution");case 1:return s.add(r),t.p=2,t.n=3,chrome.storage.local.get(["githubToken","repoUrl"]);case 3:if((c=t.v).githubToken&&c.repoUrl){t.n=4;break}throw new Error("Not authenticated. Please complete onboarding.");case 4:return a=h(c.repoUrl),i=a.owner,u=a.repo,l=e.name,p=e.difficulty,y=e.language,d=e.code,m=e.extension,v=g(l)+"."+m,w=p.toLowerCase(),S="".concat(w,"/").concat(v),j="Add ".concat(l," (").concat(p,") - ").concat(y),t.n=5,f(c.githubToken,i,u,S,d,j);case 5:return O=t.v,t.n=6,b(e);case 6:return chrome.notifications.create({type:"basic",iconUrl:"icons/icon48.png",title:"GitSync",message:"Synced: ".concat(l," to ").concat(w,"/")}),t.a(2,O);case 7:return t.p=7,setTimeout(function(){s.delete(r)},5e3),t.f(7);case 8:return t.a(2)}},t,null,[[2,,7,8]])}))).apply(this,arguments)}function f(t,e,n,r,o,c){return p.apply(this,arguments)}function p(){return(p=i(o().m(function t(e,r,c,a,i,s){var l,f,p,y,h,g,b,d,m,v,w,S,j,O,k;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:return l=null,t.p=1,t.n=2,fetch("".concat(u,"/repos/").concat(r,"/").concat(c,"/contents/").concat(a),{headers:{Authorization:"token ".concat(e),Accept:"application/vnd.github.v3+json"}});case 2:if(!(f=t.v).ok){t.n=4;break}return t.n=3,f.json();case 3:"file"===(p=t.v).type&&p.sha&&(l=p.sha,console.log("GitSync: Found existing file, using SHA:",l.substring(0,8)+"..."));case 4:t.n=6;break;case 5:t.p=5,O=t.v,console.log("GitSync: Error checking for existing file:",O);case 6:return y=n({message:s,content:btoa(unescape(encodeURIComponent(i)))},l&&{sha:l}),t.n=7,fetch("".concat(u,"/repos/").concat(r,"/").concat(c,"/contents/").concat(a),{method:"PUT",headers:{Authorization:"token ".concat(e),Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify(y)});case 7:if((h=t.v).ok){t.n=18;break}return t.n=8,h.json();case 8:if(g=t.v,!(b=g.message||"Failed to push to GitHub").includes("does not match")){t.n=17;break}return console.log("GitSync: SHA mismatch detected, fetching latest SHA and retrying"),t.p=9,t.n=10,fetch("".concat(u,"/repos/").concat(r,"/").concat(c,"/contents/").concat(a),{headers:{Authorization:"token ".concat(e),Accept:"application/vnd.github.v3+json"}});case 10:if(d=t.v,m=null,!d.ok){t.n=12;break}return t.n=11,d.json();case 11:"file"===(v=t.v).type&&v.sha&&(m=v.sha);case 12:return w=n({message:s+" (updated)",content:btoa(unescape(encodeURIComponent(i)))},m&&{sha:m}),t.n=13,fetch("".concat(u,"/repos/").concat(r,"/").concat(c,"/contents/").concat(a),{method:"PUT",headers:{Authorization:"token ".concat(e),Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify(w)});case 13:if((S=t.v).ok){t.n=15;break}return t.n=14,S.json();case 14:throw j=t.v,new Error(j.message||b);case 15:return console.log("GitSync: Successfully updated file after SHA retry"),t.a(2,S.json());case 16:throw t.p=16,k=t.v,new Error(k.message||b);case 17:throw new Error(b);case 18:return t.a(2,h.json())}},t,null,[[9,16],[1,5]])}))).apply(this,arguments)}function y(){return(y=i(o().m(function t(e){var n,r;return o().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,fetch("https://leetcode.com/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n    query questionData($titleSlug: String!) {\n      question(titleSlug: $titleSlug) {\n        questionId\n        title\n        difficulty\n        content\n      }\n    }\n  ",variables:{titleSlug:e}})});case 1:if((n=t.v).ok){t.n=2;break}throw new Error("Failed to fetch problem info");case 2:return t.n=3,n.json();case 3:return r=t.v,t.a(2,r.data.question)}},t)}))).apply(this,arguments)}function h(t){var e=t.match(/github\.com\/([^\/]+)\/([^\/]+)/);if(!e)throw new Error("Invalid GitHub repository URL");return{owner:e[1],repo:e[2].replace(/\.git$/,"")}}function g(t){if(!t||"string"!=typeof t)return console.error("GitSync: Invalid string for toCamelCase:",t),"solution";if(t=t.trim(),/^\d+$/.test(t))return console.warn("GitSync: Problem name is just a number, using default"),"solution";var e=t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,function(t,e){return e.toUpperCase()}).replace(/^./,function(t){return t.toLowerCase()}).replace(/[^a-zA-Z0-9]/g,"");return e&&0!==e.length?e:(console.warn("GitSync: camelCase conversion resulted in empty string"),"solution")}function b(t){return d.apply(this,arguments)}function d(){return(d=i(o().m(function t(e){var r,c,a;return o().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,chrome.storage.local.get(["syncedProblems"]);case 1:return r=t.v,c=r.syncedProblems||[],(a=c.findIndex(function(t){return t.name===e.name&&t.language===e.language}))>=0?c[a]=n(n({},e),{},{syncedAt:Date.now()}):c.unshift(n(n({},e),{},{syncedAt:Date.now()})),t.n=2,chrome.storage.local.set({syncedProblems:c.slice(0,100)});case 2:return t.a(2)}},t)}))).apply(this,arguments)}console.log("GitSync background service worker started")})();